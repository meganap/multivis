function ParallelCoordinates(){var t,e,a=new Rainbow,n,r=[];this.setData=function(e){t=e,this.initParallelCoordinates()},this.initParallelCoordinates=function(){pwidth=document.getElementById("plot").offsetWidth,pheight=document.getElementById("plot").offsetHeight,t.forEach(function(t){t.Individual=t.Individual.substring(0,11),r.push(t.Individual)}),r=this.dedupe(r),a.setNumberRange(0,r.length),this.drawPlot()},this.dedupe=function(t){for(var e={},a=0;a<t.length;a++)e[t[a]]=!0;t=[];for(var n in e)t.push(n);return t},this.drawPlot=function(){document.getElementById("plot").innerHTML='<div id="parallelPlot" class="parcoords" style="width:'+pwidth+"px;height:"+pheight+'px"></div>',e=d3.parcoords()("#parallelPlot"),e.data(t).color(function(t){return"#"+a.colorAt(r.indexOf(t.colorKey||t.Individual))}).margin({top:40,left:20,bottom:40,right:50}).ticks(5).render().brushable(),svg=d3.select("#parallelPlot").append("svg").attr("class","parallelLegend"),this.drawLegend()},this.drawLegend=function(){svg.selectAll(".legend").selectAll("text").remove(),svg.selectAll(".legend").selectAll("rect").remove(),legend=svg.selectAll(".legend").data(r),legend.enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"}),legend.append("rect").attr("x",pwidth+76).attr("width",16).attr("height",16).style("fill",function(t){return"#"+a.colorAt(r.indexOf(t))}),legend.append("text").attr("x",pwidth+70).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t}),legend.exit().remove()},this.changeColors=function(t){this.setColorBy(t)},this.setColorBy=function(n){r=[],t.forEach(function(t){t.colorKey="Environment"==n?-1!=t.SampleID.indexOf("key")||-1!=t.SampleID.indexOf("space")?"Key":"Finger":t.Individual,r.push(t.colorKey)}),r=this.dedupe(r),a.setNumberRange(0,r.length),e.data(t).updateAxes().render(),this.drawLegend()}}function Partition(t){var e=1120,a=600,n=d3.scale.linear().range([0,e]),r=d3.scale.linear().range([0,a]),i,o,s,l,d,c=this,u;this.initPartition=function(){u=d3.select("#visWrapper").append("div").attr("class","tooltip").style("opacity",0),i=d3.select("#plot").append("div").attr("class","chart").style("width",e+"px").style("height",a+"px").append("svg:svg").attr("width",e).attr("height",a),o=d3.layout.partition().value(function(t){return t.length}),d3.json(t,function(t){function l(t){if(t.children){c=(t.y?e-40:e)/(1-t.y),p=a/t.dx,n.domain([t.y,1]).range([t.y?40:0,e]),r.domain([t.x,t.x+t.dx]);var i=s.transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+n(t.y)+","+r(t.x)+")"});i.select("rect").attr("width",t.dy*c).attr("height",function(t){return t.dx*p}),i.select("text").attr("transform",d).text(function(t){return t.name}).style("display",function(t){return t.dx*p>12&&t.dx>this.getComputedTextLength()?"block":"none"}),d3.event.stopPropagation()}}function d(t){return"translate(1,"+t.dx*p/2+")"}s=i.selectAll("g").data(o.nodes(t)).enter().append("svg:g").attr("transform",function(t){return"translate("+n(t.y)+","+r(t.x)+")"}).on("click",function(t){l(t)});var c=e/t.dx,p=a/1;s.append("svg:rect").attr("width",t.dy*c).attr("height",function(t){return t.dx*p}).attr("class",function(t){return t.children?"parent":"child"}).attr("class","map").on("mouseover",function(t){this.style.opacity=.6,u.transition().duration(200).style("opacity",.9),u.html(t.name).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){this.style.opacity=1,u.transition().duration(500).style("opacity",0)}),s.append("svg:text").attr("transform",d).attr("class","treemaptext").text(function(t){return t.name}).style("display",function(t){return t.dx*p>12&&t.dx>this.getComputedTextLength()?"block":"none"}),d3.select(window).on("click",function(){l(t)})})}}function Scatter(){var t,e,a,n,r,i,o,s,l,d,c,u=new Rainbow,p,h=[],m=[],f,g,v;this.setData=function(e){t=e,this.initScatter()},this.initScatter=function(){e={top:20,right:20,bottom:30,left:40},a=document.getElementById("plot").offsetWidth,n=.97*a-e.left-e.right,r=600-e.top-e.bottom,document.getElementById("plot").innerHTML='<div id="scatter" class="scatter"></div>',d3.select("#visWrapper").append("div").attr("id","axisChoosers").attr("class","axisChoosers"),document.getElementById("axisChoosers").innerHTML='<div id="legendHolder"></div><br><div>X axis:<select id="Xaxis" onchange="javascript:s.axisChanged()"></select><br>Y axis:<select id="Yaxis" onchange="javascript:s.axisChanged()"></select></div>',i=d3.scale.linear().range([0,n]),o=d3.scale.linear().range([r,0]),s=d3.svg.axis().scale(i).orient("bottom"),l=d3.svg.axis().scale(o).orient("left"),d=d3.select("#scatter").append("svg").attr("width",n+e.left+e.right).attr("height",r+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),d3.select("#legendHolder").attr("width",50).attr("height",50),h=d3.keys(t[0]),h.splice(h.indexOf("Individual"),2),this.setSelects(),t.forEach(function(t){m.push(t.Individual.substring(0,11)),h.forEach(function(e){t[e]=+t[e]}),t.ID=t.Individual,t.colorKey=t.ID.substring(0,11),t.uniqueID=t.colorKey+t.ID+f.selectedIndex+g.selectedIndex}),m=this.dedupe(m),u.setNumberRange(0,m.length),this.drawPlot(t)},this.changeColors=function(t){this.setColorBy(t)},this.setColorBy=function(e){m=[],t.forEach(function(t){t.colorKey="Environment"==e?-1!=t.SampleID.indexOf("key")||-1!=t.SampleID.indexOf("space")?"Key":"Finger":t.ID.substring(0,11),m.push(t.colorKey),t.uniqueID=t.colorKey+t.ID+f.selectedIndex+g.selectedIndex}),m=this.dedupe(m),u.setNumberRange(0,m.length),this.drawPlot(t)},this.setSelects=function(){f=document.getElementById("Xaxis"),g=document.getElementById("Yaxis");var t=document.createElement("option");for(var e in h)t=document.createElement("option"),t.text=h[e],f.add(t),t=document.createElement("option"),t.text=h[e],g.add(t);f.selectedIndex=0,g.selectedIndex=1},this.axisChanged=function(){t.forEach(function(t){t.uniqueID=t.uniqueID=t.colorKey+t.ID+f.selectedIndex+g.selectedIndex}),this.drawPlot(t)},this.drawLegend=function(){d.selectAll(".legend").selectAll("text").remove(),d.selectAll(".legend").selectAll("rect").remove(),c=d.selectAll(".legend").data(m),c.enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"}),c.append("rect").attr("x",n-18).attr("width",18).attr("height",18).style("fill",function(t){return"#"+u.colorAt(m.indexOf(t))}),c.append("text").attr("x",n-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t}),c.exit().remove()},this.drawPlot=function(t){i.domain(d3.extent(t,function(t){return t[f.selectedIndex+1]})).nice(),o.domain(d3.extent(t,function(t){return t[g.selectedIndex+1]})).nice(),d.select("#xaxis").remove(),d.select("#yaxis").remove(),d.selectAll(".dot").remove(),d.append("g").attr("class","x axis").attr("id","xaxis").attr("transform","translate(0,"+r+")").call(s).append("text").attr("class","label").attr("x",n).attr("y",-6).style("text-anchor","end").text("Axis "+(f.selectedIndex+1)),d.append("g").attr("class","y axis").attr("id","yaxis").call(l).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Axis "+(g.selectedIndex+1));var e=d.selectAll(".dot").data(t,function(t){return t.uniqueID});e.enter().append("circle").attr("class","dot").attr("r",3.5).attr("cx",function(t){return i(t[f.selectedIndex+1])}).attr("cy",function(t){return o(t[g.selectedIndex+1])}).style("fill",function(t){return"#"+u.colorAt(m.indexOf(t.colorKey))}),e.exit().remove(),this.drawLegend()},this.dedupe=function(t){for(var e={},a=0;a<t.length;a++)e[t[a]]=!0;t=[];for(var n in e)t.push(n);return t}}function Splom(){function t(t){e.data!==t&&(h.call(e.clear()),e.x(d[t.x]).y(c[t.y]).data=t)}function e(t){var a=e.extent();p.selectAll(".cell circle").attr("class",function(e){return a[0][0]<=e[t.x]&&e[t.x]<=a[1][0]&&a[0][1]<=e[t.y]&&e[t.y]<=a[1][1]?e.Individual:null})}function a(){e.empty()&&p.selectAll(".cell circle").attr("class",function(t){return t.Individual})}function n(t,e){var a=[],n=t.length,r=e.length,i,o;for(i=-1;++i<n;)for(o=-1;++o<r;)a.push({x:t[i],i:i,y:e[o],j:o});return a}var r,i,o=140,s=10,l=4,d={},c={},u,e=d3.svg.brush().on("brushstart",t).on("brush",e).on("brushend",a),p,h,m,f,g,v=[],y,x,b=new Rainbow;this.setData=function(t){r=t,this.initSplom()},this.initSplom=function(){m=document.getElementById("plot").offsetWidth,f=.97*m,g=600,document.getElementById("plot").innerHTML='<div id="splom" class="splom"></div>',y=d3.keys(r[0]),y.splice(y.indexOf("Individual"),2),x=[],r.forEach(function(t){v.push(t.Individual.substring(0,11));var e={};y.forEach(function(a){e[a]=+t[a]}),e.Individual=t.Individual.substring(0,11),t.Individual=t.Individual.substring(0,11),t.colorKey=t.Individual,x.push(e)}),v=this.dedupe(v),i={axes:y,groups:v,values:x},i.values.forEach(function(t){i.axes.forEach(function(t){var e=function(e){return e[t]},a=[d3.min(i.values,e),d3.max(i.values,e)],n=[s/2,o-s/2];d[t]=d3.scale.linear().domain(a).range(n),c[t]=d3.scale.linear().domain(a).range(n.reverse())})}),b.setNumberRange(0,v.length),this.drawPlot()},this.changeColors=function(t){this.setColorBy(t)},this.setColorBy=function(t){v=[],r.forEach(function(e){e.colorKey="Environment"==t?-1!=e.SampleID.indexOf("key")||-1!=e.SampleID.indexOf("space")?"Key":"Finger":e.Individual,v.push(e.colorKey)}),v=this.dedupe(v),i={axes:y,groups:v,values:x},b.setNumberRange(0,v.length),this.drawPlot()},this.drawPlot=function(){d3.select("#splom").selectAll("svg").remove(),u=d3.svg.axis().ticks(5).tickSize(o*l),p=d3.select("#splom").append("svg:svg").attr("width",f).attr("height",g).append("svg:g").attr("transform","translate(5,5)"),p.selectAll("g.x.axis").data(y).enter().append("svg:g").attr("class","x axis").attr("transform",function(t,e){return"translate("+e*o+",0)"}).each(function(t){d3.select(this).call(u.scale(d[t]).orient("bottom"))}),p.selectAll("g.y.axis").data(y).enter().append("svg:g").attr("class","y axis").attr("transform",function(t,e){return"translate(0,"+e*o+")"}).each(function(t){d3.select(this).call(u.scale(c[t]).orient("right"))}),h=p.selectAll("g.cell").data(n(y,y)).enter().append("svg:g").attr("class","cell").attr("transform",function(t){return"translate("+t.i*o+","+t.j*o+")"}).each(this.plot),h.filter(function(t){return t.i==t.j}).append("svg:text").attr("x",s).attr("y",s).attr("dy",".71em").text(function(t){return"Axis "+t.x}),h.filter(function(t){return t.i!=t.j}).append("svg:text").attr("x",s).attr("y",s).attr("dy",".71em").text(function(t){return"Axis "+t.x+" Ã— Axis "+t.y}),this.drawLegend()},this.drawLegend=function(){legend=p.selectAll(".legend").data(v),legend.enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"}),legend.append("rect").attr("x",f-24).attr("width",16).attr("height",16).style("fill",function(t){return"#"+b.colorAt(v.indexOf(t))}),legend.append("text").attr("x",f-30).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t}),legend.exit().remove()},this.plot=function(t){var a=d3.select(this);a.append("svg:rect").attr("class","frame").attr("x",s/2).attr("y",s/2).attr("width",o-s).attr("height",o-s),a.selectAll("circle").data(r).enter().append("svg:circle").attr("class",function(t){return t.colorKey}).attr("cx",function(e){return d[t.x](e[t.x])}).attr("cy",function(e){return c[t.y](e[t.y])}).attr("r",3),a.call(e.x(d[t.x]).y(c[t.y]))},this.dedupe=function(t){for(var e={},a=0;a<t.length;a++)e[t[a]]=!0;t=[];for(var n in e)t.push(n);return t}}function NormalizedStackedBar(){var t,e,a,n,r,i,s,l,d,c,s,u,p,h,m,f,g,v,y,x,b,w,I=new Rainbow,A,S="",E="";this.setBiom=function(t){p=t,this.initTaxonomyBarChart()},this.initTaxonomyBarChart=function(){a=document.getElementById("plot").offsetWidth,t={top:30,right:20,bottom:180,left:60},e=.97*a,n=600-t.top-t.bottom,r=d3.scale.ordinal().rangeBands([0,e],.1),i=d3.scale.linear().rangeRound([n,0]),I.setSpectrum("lime","blue","red","yellow"),d=d3.svg.axis().scale(r).orient("bottom"),c=d3.svg.axis().scale(i).orient("left").tickFormat(d3.format(".0%")),u=d3.select("#plot").append("div").attr("class","tooltip").style("opacity",0);var o=["Phylum","Class","Order","Family","Genus","Species"];g=d3.select("#yaxisholder"),x=g.append("svg").attr("width",t.left).attr("height",n+t.top+10).attr("id","yaxis").append("g").attr("transform","translate("+t.left+","+t.top+")"),f=d3.select("#plot"),v=f.append("svg").attr("width",e+t.right).attr("height",n+t.top+t.bottom).attr("id","chart").append("g").attr("transform","translate(10,"+t.top+")"),this.setData(0),this.setMetadataTypes(),this.setSelect(),this.buildKey(b),r.domain(h.map(function(t){return t.SampleID}));var l=[{SampleID:"Sample1"}];y=v.selectAll(".SampleID").data(l).enter().append("g").attr("class","SampleID"),x.append("g").attr("class","y axis").call(c),x.append("text").attr("class","axisLabel").attr("text-anchor","middle").attr("y",-55).attr("x",-n/2).attr("dy",".75em").attr("transform","rotate(-90)").text("Abundance");var p=[{group:"SampleID"}];s=v.selectAll(".sortHeaders").data(p).enter().append("g").attr("class","groups"),this.sortChanged()},this.changeLevel=function(t){document.querySelectorAll(".selected_classification")[0].className="unselected_classification",document.getElementById("classification"+t).className="selected_classification",A=t,this.setData(t),this.buildKey(b),this.sortChanged()},this.setSelect=function(){var t=document.getElementById("sort_by_select"),e=document.getElementById("group_by_select"),a=document.createElement("option");a.text="SampleID",t.add(a),a=document.createElement("option"),a.text="SampleID",e.add(a);var n=d3.keys(p.columns[0].metadata);n.sort();for(var r in n)a=document.createElement("option"),a.text=n[r],t.add(a),a=document.createElement("option"),a.text=n[r],e.add(a)},this.setMetadataTypes=function(){m={};for(var t=d3.keys(h[d3.keys(h)[0]].metadata),e=0;e<t.length;e++)m[t[e]]=null;var a=h[d3.keys(h)[0]];for(var n in m){var r,i=Number(a.metadata[n]);r=isNaN(i)?"string":"number";for(var o in h){var s=h[o].metadata[n];if("NA"!=s){var l=Number(s),d;if(d=isNaN(l)?"string":"number",d!==r){r="string";break}}}m[n]=r}},this.sortChanged=function(){var t=document.getElementById("sort_by_select")[document.getElementById("sort_by_select").selectedIndex].text;E=t;var e=m[t];h.sort(function(a,n){var r;return r="SampleID"===t?a.SampleID.localeCompare(n.SampleID):"NA"===a.metadata[t]&&"NA"===n.metadata[t]?0:"NA"===a.metadata[t]&&"NA"!==n.metadata[t]?-1:"NA"!==a.metadata[t]&&"NA"===n.metadata[t]?1:"number"===e?a.metadata[t]-n.metadata[t]:"string"===e?a.metadata[t].localeCompare(n.metadata[t]):0,0===r?a.SampleID.localeCompare(n.SampleID):r});var a={};"SampleID"!==t&&h.forEach(function(e){var n=e.metadata[t];n in a?a[n]++:a[n]=1}),document.getElementById("group_by_select").selectedIndex=0,this.getTotalAbundances(h),this.drawTaxonomyBarVis(h),a.length!==h.length&&"SampleID"!==t?this.drawSortHeaders(a):s.selectAll("g").remove()},this.getTotalAbundances=function(t){var e={};for(var a in t)for(var n=t[a].abundances,r=0;r<n.length;r++)n[r].name in e||(e[n[r].name]=0),e[n[r].name]+=Math.abs(n[r].y0-n[r].y1)},this.groupChanged=function(){var t=[],e={},a={},n=document.getElementById("group_by_select")[document.getElementById("group_by_select").selectedIndex].text;S=n;for(var r=d3.keys(h),i=0;i<r.length;i++){var o=r[i],l=h[o].metadata[n];"SampleID"==n&&(l=h[o].SampleID),l in a||(a[l]={}),l in e||(e[l]=0),e[l]+=1;for(var d=d3.keys(h[o].tax),c=0;c<d.length;c++){var u=d[c];u in a[l]||(a[l][u]=0),a[l][u]+=h[o].tax[u]}}for(var p=d3.keys(a),f,i=0;i<p.length;i++)f={SampleID:p[i]},f.tax=a[p[i]],f.count=e[p[i]],t.push(f);var g=d3.keys(h[d3.keys(h)[0]].tax);t.forEach(function(t){var e=0;t.abundances=g.map(function(a){return{name:a,y0:e,y1:e+=+t.tax[a]}}),t.abundances.forEach(function(t){t.y0/=e,t.y1/=e}),t.total=t.abundances[t.abundances.length-1].y1,t.metadata=t.metadata}),I.setNumberRange(0,g.length);var v=m[n];t.sort(function(t,e){var a;return"NA"==t.SampleID&&"NA"==e.SampleID?0:"NA"==t.SampleID&&"NA"!==e.SampleID?-1:"NA"!==t.SampleID&&"NA"==e.SampleID?1:"string"===v?t.SampleID.localeCompare(e.SampleID):"number"===v?Number(t.SampleID)-Number(e.SampleID):0}),this.getTotalAbundances(t),this.drawTaxonomyBarVis(t,!0),s.selectAll("g").remove()},this.setData=function(t){h=[];var e=[],a={};if(b=[],"dense"==p.matrix_type)for(var n=0;n<p.columns.length;n++){e[n]=p.columns[n].id,a={SampleID:e[n]},a.metadata=p.columns[n].metadata,a.tax={};for(var r=0;r<p.rows.length;r++){var i=p.rows[r].metadata.taxonomy[t];b.push(i),i in a.tax||(a.tax[i]=0),a.tax[i]+=p.data[r][n]}h.push(a)}else{var s={};b=[];for(var r=0;r<p.data.length;r++){var l=p.data[r][0],d=p.data[r][1],c=p.data[r][2],i=p.rows[l].metadata.taxonomy[t];if(void 0!=i){b.push(i);var u=p.columns[d].id;u in s||(s[u]={},s[u].metadata=p.columns[d].metadata),i in s[u]||(s[u][i]=0),s[u][i]+=c}}b=this.dedupe(b);for(o in s){a={SampleID:o},a.metadata=s[o].metadata,a.tax={};for(var n=0;n<b.length;n++)a.tax[b[n]]=b[n]in s[o]?s[o][b[n]]:0;h.push(a)}}var m=d3.keys(h[d3.keys(h)[0]].tax);h.forEach(function(t){var e=0;t.abundances=m.map(function(a){return{name:a,y0:e,y1:e+=+t.tax[a]}}),t.abundances.forEach(function(t){t.y0/=e,t.y1/=e}),t.total=t.abundances[t.abundances.length-1].y1,t.metadata=t.metadata}),h.sort(function(t,e){return e.total-t.total}),b.sort(),I.setNumberRange(0,m.length)},this.buildKey=function(t){var e="<ul id='key'>",a="";for(var n in t)e+="<li><div class='colorbox' style='background-color:",e+="#"+I.colorAt(n),e+="'></div>"+t[n]+"</li>";e+="</ul>",document.getElementById("color_list").innerHTML=e},this.dedupe=function(t){for(var e={},a=0;a<t.length;a++)e[t[a]]=!0;t=[];for(var n in e)t.push(n);return t},this.drawSortHeaders=function(t){var e=[],a=0,i=r.rangeBand()+.1*r.rangeBand();for(var o in t)e.push({group:o,count:t[o],offset:a*i+.1*r.rangeBand(),textLocation:a*i+.1*r.rangeBand()+t[o]*i/2,width:t[o]*i}),a+=t[o];var l=s.selectAll("g").data(e,function(t){return t.group});l.enter().append("g").attr("width",function(t){return t.width}).attr("height",10).attr("x",function(t){return t.offset}).on("mouseover",function(t){}).on("mouseout",function(t){}).append("text").attr("class","sortLabel").attr("x",function(t){return t.textLocation}).attr("y",-13).attr("text-anchor","middle").text(function(t){return t.group}),l.append("rect").attr("width",1).attr("height",5).attr("y",-10).attr("x",function(t){return t.textLocation}),l.append("rect").attr("fill-opacity","0").attr("stroke","#000").attr("id",function(t){return t.group+"Rect"}).attr("width",function(t){return t.width}).attr("height",n+5).attr("y",-5).attr("x",function(t){return t.offset}).attr("rx",3).attr("ry",3),l.exit().remove()},this.drawTaxonomyBarVis=function(t,a){t.forEach(function(t){t.uniquename=t.SampleID+A+S+E}),r.domain(t.map(function(t){return t.SampleID})),i.domain([0,d3.max(t,function(t){return t.total})]),v.selectAll(".xAxisLabel").remove(),y.selectAll("text").remove();var o=y.selectAll("g").data(t,function(t){return t.uniquename});o.enter().append("g").attr("transform",function(t){return"translate("+r(t.SampleID)+",0)"}),t.length<100&&(a=!0),a?o.append("text").attr("y",r.rangeBand()/2).attr("x",-n-15).attr("text-anchor","end").attr("transform",function(t){return"rotate(-90)"}).text(function(t){return t.SampleID}):v.append("text").attr("class","xAxisLabel").attr("text-anchor","middle").attr("x",e/2).attr("y",n+50).text("Sample");var s=o.selectAll("rect").data(function(t){return t.abundances});s.enter().append("rect").attr("width",r.rangeBand()).attr("y",function(t){return i(t.y1)}).attr("height",function(t){return i(t.y0)-i(t.y1)}).style("fill",function(t){return"#"+I.colorAt(b.indexOf(t.name))}).on("mouseover",function(t){this.style.opacity=.6,u.transition().duration(200).style("opacity",.9),u.html(t.name+": "+(100*Math.abs(t.y0-t.y1)).toFixed(2)+"%").style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){this.style.opacity=1,u.transition().duration(500).style("opacity",0)}),s.exit().remove(),o.exit().remove()}}function Sunburst(t){var e,a,n=600,r=n,i=90,o=(Math.min(n,r)-2*i)/2,s=1e3,l,d,c,u=new Rainbow,p,h=this,m=0,f=0,g={w:80,h:30,s:3,t:10};this.initSunburst=function(){s=d3.select("visWrapper").append("div").attr("class","tooltip").style("opacity",0),e=d3.scale.linear().range([0,2*Math.PI]),a=d3.scale.pow().exponent(1.3).domain([0,1]).range([0,o]);var s=d3.select("#plot"),c=s.append("svg").attr("width",n).attr("height",r).append("g").attr("transform","translate("+[o+i,o+i]+")"),u=d3.layout.partition().size([2*Math.PI,o*o]).value(function(t){return t.length});this.arc(),d3.json(t,function(t){var e=u.nodes(t);t=t,paths=c.selectAll("path").data(e),d=paths.enter().append("path").attr("id","sunburst").attr("d",l).attr("fill-rule","evenodd").attr("display",function(t){return t.depth?null:"none"}).style("fill","#3182bd").on("mouseover",function(t){this.style.opacity=.6}).on("mouseout",function(t){this.style.opacity=1});var a=paths.enter().append("text").attr("text-anchor","end").attr("text-anchor",function(t){var e=(t.x+t.dx/2-Math.PI/2)/Math.PI*180;return(t.x+t.dx/2-Math.PI/2)/Math.PI*180<90?"middle":"end"}).attr("dy",".2em").attr("dx","5").attr("transform",function(t){var e=(t.x+t.dx/2-Math.PI/2)/Math.PI*180;return"rotate("+e+")translate("+(Math.sqrt(t.y)+35)+")rotate("+(e>90?-180:0)+")"}).text(function(t){return t.name})}),d3.select("#container").on("mouseleave",this.mouseleave),d3.select(self.frameElement).style("height",r+"px")},this.arc=function(){l=d3.svg.arc().startAngle(function(t){return t.x}).endAngle(function(t){return t.x+t.dx}).innerRadius(function(t){return Math.sqrt(t.y)}).outerRadius(function(t){return Math.sqrt(t.y+t.dy)})}}function ComparativeSunburst(){function t(t){return t.children?!1:!0}var e,a,n=500,r=n,i=5,o=(Math.min(n,r)-2*i)/2,s=1e3,l,d,u,p=[],h,m,f=[],g,v,y=[],x,b=[],w,I,A=[],S=!1,E="Location",D,T,B=this;this.initJquery=function(){$(function(){$("input[type=button], a, button").button().click(function(t){t.preventDefault()})}),$(function(){$("#syncToggle").button().click(function(t){S=!S})}),$(function(){$("#sync").buttonset().change(function(t){E=$("#syncOptions input[name=sync]:checked").val()})})},this.setVals=function(t,e){h=t,w=this.getTips(h),m=e,I=this.getTips(m),f.push(t),f.push(e),A.push(w),A.push(I),this.initCanvas()},this.drawSunburst=function(t,e,a,s){var d=a.append("svg").attr("width",n).attr("height",r).append("g").attr("transform","translate("+[o+i,o+i]+")"),c=d3.layout.partition().value(function(t){return t.length}),u=c.nodes(t);return path=d.selectAll("path").data(u),path.enter().append("path").attr("d",l).attr("fill-rule","evenodd").style("fill",function(t){return B.getColor(t,e)}).on("mouseover",function(t){this.style.opacity=.6,x.transition().duration(200).style("opacity",.9),x.html(t.name).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){this.style.opacity=1,x.transition().duration(500).style("opacity",0)}).on("click",function(t){B.click(t,s)}),path},this.initCanvas=function(){x=d3.select("#visWrapper").append("div").attr("class","tooltip").style("opacity",0),e=d3.scale.linear().range([0,2*Math.PI]),a=d3.scale.pow().exponent(1.3).domain([0,1]).range([0,o]),l=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,e(t.x)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,e(t.x+t.dx)))}).innerRadius(function(t){return Math.max(0,a(t.y))}).outerRadius(function(t){return Math.max(0,a(t.y+t.dy))});var t=d3.select("#plot1"),n=d3.select("#plot2");d=this.drawSunburst(h,I,t,0),p[0]=d,u=this.drawSunburst(m,w,n,1),p[1]=u,d3.select(self.frameElement).style("height",r+"px")},this.getColor=function(e,a){if(t(e))return e.name?-1==a.indexOf(e.name)?"#ff0000":"#0000ff":"#ff0000";var n=[];for(i in e.children)n.push(this.getColor(e.children[i],a));for(var r=n[0],i=1;i<n.length;i++)r=$.xcolor.average(r,n[i]);return r},this.getTips=function(e){var a=[];if(t(e))return""!=e.name&&a.push(e.name),a;for(c in e.children)a.push.apply(a,this.getTips(e.children[c]));return a},this.click=function(t,e){if(D=p[e],T=f[e],S)if("Location"==E)for(var a=0;a<p.length;a++)p[a].transition().duration(750).attrTween("d",this.arcTween(t));else for(var n=t.name,a=0;a<f.length;a++){var r=this.getNodeMatchingName(n,f[a]);null!=r?p[a].transition().duration(750).attrTween("d",this.arcTween(r)):console.log(n+" not in tree number "+a)}else D.transition().duration(750).attrTween("d",this.arcTween(t))},this.getNodeMatchingName=function(e,a){if(a.name===e)return a;if(t(a))return null;for(c in a.children)return this.getNodeMatchingName(e,a.children[c]);return null},this.isParentOf=function(t,e){return t===e?!0:t.children?t.children.some(function(t){return this.isParentOf(t,e)}):!1},this.arcTween=function(t){var n=d3.interpolate(e.domain(),[t.x,t.x+t.dx]),r=d3.interpolate(a.domain(),[t.y,1]),i=d3.interpolate(a.range(),[t.y?20:0,o]);return function(t,o){return o?function(e){return l(t)}:function(o){return e.domain(n(o)),a.domain(r(o)).range(i(o)),l(t)}}},this.getDepth=function(t){var e=0;return t.children&&t.children.forEach(function(t){var a=this.getDepth(t);a>e&&(e=a)}),1+e},this.zoomOut=function(){if(S)for(var t=0;t<p.length;t++)p[t].transition().duration(750).attrTween("d",this.arcTween(T));else D.transition().duration(750).attrTween("d",this.arcTween(T))}}function createVisualization(t){initializeBreadcrumbTrail(),drawLegend(),d3.select("#togglelegend").on("click",toggleLegend),vis.append("svg:circle").attr("r",radius).style("opacity",0);var e=partition.nodes(t).filter(function(t){return t.dx>.005}),a=vis.data([t]).selectAll("path").data(e).enter().append("svg:path").attr("display",function(t){return t.depth?null:"none"}).attr("d",arc).attr("fill-rule","evenodd").style("fill",function(t){return"#"+colors[t.name]}).style("opacity",1).on("mouseover",mouseover);d3.select("#container").on("mouseleave",mouseleave),totalSize=a.node().__data__.value}function mouseover(t){var e=(100*t.value/totalSize).toPrecision(3),a=e+"%";.1>e&&(a="< 0.1%"),d3.select("#percentage").text(a),d3.select("#explanation").style("visibility","");var n=getAncestors(t);updateBreadcrumbs(n,a),d3.selectAll("path").style("opacity",.3),vis.selectAll("path").filter(function(t){return n.indexOf(t)>=0}).style("opacity",1)}function mouseleave(t){d3.select("#trail").style("visibility","hidden"),d3.selectAll("path").on("mouseover",null),d3.selectAll("path").transition().duration(1e3).style("opacity",1).each("end",function(){d3.select(this).on("mouseover",mouseover)}),d3.select("#explanation").transition().duration(1e3).style("visibility","hidden")}function getAncestors(t){for(var e=[],a=t;a.parent;)e.unshift(a),a=a.parent;return e}function initializeBreadcrumbTrail(){var t=d3.select("#sequence").append("svg:svg").attr("width",width).attr("height",50).attr("id","trail");t.append("svg:text").attr("id","endlabel").style("fill","#000")}function breadcrumbPoints(t,e){var a=[];return a.push("0,0"),a.push(b.w+",0"),a.push(b.w+b.t+","+b.h/2),a.push(b.w+","+b.h),a.push("0,"+b.h),e>0&&a.push(b.t+","+b.h/2),a.join(" ")}function updateBreadcrumbs(t,e){var a=d3.select("#trail").selectAll("g").data(t,function(t){return t.name+t.depth}),n=a.enter().append("svg:g");n.append("svg:polygon").attr("points",breadcrumbPoints).style("fill",function(t){return"#"+colors[t.name]}),n.append("svg:text").attr("x",(b.w+b.t)/2).attr("y",b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.name}),a.attr("transform",function(t,e){return"translate("+e*(b.w+b.s)+", 0)"}),a.exit().remove(),d3.select("#trail").select("#endlabel").attr("x",(t.length+.5)*(b.w+b.s)).attr("y",b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(e),d3.select("#trail").style("visibility","")}function drawLegend(){var t={w:75,h:30,s:3,r:3},e=d3.select("#legend").append("svg:svg").attr("width",t.w).attr("height",d3.keys(colors).length*(t.h+t.s)),a=e.selectAll("g").data(d3.entries(colors)).enter().append("svg:g").attr("transform",function(e,a){return"translate(0,"+a*(t.h+t.s)+")"});a.append("svg:rect").attr("rx",t.r).attr("ry",t.r).attr("width",t.w).attr("height",t.h).style("fill",function(t){return"#"+t.value}),a.append("svg:text").attr("x",t.w/2).attr("y",t.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.key})}function toggleLegend(){var t=d3.select("#legend");"hidden"==t.style("visibility")?t.style("visibility",""):t.style("visibility","hidden")}function initSunburst(){div=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),x=d3.scale.linear().range([0,2*Math.PI]),y=d3.scale.pow().exponent(1.3).domain([0,1]).range([0,radius]);var t=d3.select("#plot1"),e=t.append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+[radius+padding,radius+padding]+")"),a=d3.select("#plot2"),n=a.append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+[radius+padding,radius+padding]+")"),r=d3.layout.partition().value(function(t){return t.length});arc=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,x(t.x)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,x(t.x+t.dx)))}).innerRadius(function(t){return Math.max(0,y(t.y))}).outerRadius(function(t){return Math.max(0,y(t.y+t.dy))}),d3.json("data/test.json",function(t){var a=r.nodes(t);root1=t,rainbow1.setNumberRange(0,getDepth(t)),path1=e.selectAll("path").data(a),path1.enter().append("path").attr("d",arc).attr("fill-rule","evenodd").style("fill",function(t){return rainbow1.colorAt(t.depth)}).on("click",click).on("mouseover",function(t){mouseover(t,e)})}),d3.json("data/keyboard_w_lengths.json",function(t){var e=r.nodes(t);rainbow2.setNumberRange(0,getDepth(t)),path2=n.selectAll("path").data(e),path2.enter().append("path").attr("d",arc).attr("fill-rule","evenodd").style("fill",function(t){return"#"+rainbow2.colorAt(t.depth)}).on("click",click).on("mouseover",function(t){mouseover(t,n)})}),d3.select("#container").on("mouseleave",mouseleave),d3.select(self.frameElement).style("height",height+"px"),initializeBreadcrumbTrail()}function click(t){console.log(t),path1.transition().duration(750).attrTween("d",arcTween(t)),path2.transition().duration(750).attrTween("d",arcTween(t))}function isParentOf(t,e){return t===e?!0:t.children?t.children.some(function(t){return isParentOf(t,e)}):!1}function arcTween(t){var e=d3.interpolate(x.domain(),[t.x,t.x+t.dx]),a=d3.interpolate(y.domain(),[t.y,1]),n=d3.interpolate(y.range(),[t.y?20:0,radius]);return function(t,r){return r?function(e){return arc(t)}:function(r){return x.domain(e(r)),y.domain(a(r)).range(n(r)),arc(t)}}}function getDepth(t){var e=0;return t.children&&t.children.forEach(function(t){var a=getDepth(t);a>e&&(e=a)}),1+e}function zoomOut(){path1.transition().duration(750).attrTween("d",arcTween(root1)),path2.transition().duration(750).attrTween("d",arcTween(root1))}function mouseover(t,e){var a=getAncestors(t);updateBreadcrumbs(a),d3.selectAll("path").style("opacity",.3),e.selectAll("path").filter(function(t){return a.indexOf(t)>=0}).style("opacity",1)}function mouseleave(t){d3.select("#trail").style("visibility","hidden"),d3.selectAll("path").on("mouseover",null),d3.selectAll("path").transition().duration(1e3).style("opacity",1).each("end",function(){d3.select(this).on("mouseover",mouseover)}),d3.select("#explanation").transition().duration(1e3).style("visibility","hidden")}function getAncestors(t){for(var e=[],a=t;a.parent;)e.unshift(a),a=a.parent;return e}function initializeBreadcrumbTrail(){var t=d3.select("#sequence").append("svg:svg").attr("width","100%").attr("height",50).attr("id","trail");t.append("svg:text").attr("id","endlabel").style("fill","#000")}function breadcrumbPoints(t,e){var a=[];return a.push("0,0"),a.push(b.w+",0"),a.push(b.w+b.t+","+b.h/2),a.push(b.w+","+b.h),a.push("0,"+b.h),e>0&&a.push(b.t+","+b.h/2),a.join(" ")
}function updateBreadcrumbs(t){var e=t.length;e>10&&(t=t.slice(e-11,e));var a=d3.select("#trail").selectAll("g").data(t,function(t){return t.name+t.depth}),n=a.enter().append("svg:g");n.append("svg:polygon").attr("points",breadcrumbPoints).style("fill",function(t){return"#"+rainbow1.colorAt(t.depth)}),n.append("svg:text").attr("x",(b.w+b.t)/2).attr("y",b.h/2).attr("dy","0.35em").attr("text-anchor","middle").on("mouseover",function(t){div.transition().style("opacity",.9),div.html(t.name).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-8+"px")}).on("mouseout",function(t){this.style.opacity=1,div.transition().style("opacity",0)}).on("click",click).text(function(t){return t.name.length>8?t.name.slice(0,5)+"...":t.name}),a.attr("transform",function(t,e){return"translate("+e*(b.w+b.s)+", 0)"}),a.exit().remove(),d3.select("#trail").style("visibility","")}function Treemap(t){var e=920,a=620,n=d3.scale.linear().range([0,e]),r=d3.scale.linear().range([0,a]),i=d3.scale.category20c(),o,s,l,d,o,c,u,p,h=this,m;this.initTreemap=function(){m=d3.select("#visWrapper").append("div").attr("class","tooltip").style("opacity",0),l=d3.layout.treemap().round(!1).size([e,a]).sticky(!0).value(function(t){return t.length}),d=d3.select("#plot").append("div").attr("class","chart").style("width",e+"px").style("height",a+"px").append("svg:svg").attr("width",e).attr("height",a).append("svg:g").attr("transform","translate(.5,.5)"),d3.json(t,function(t){s=o=t,u=l.nodes(o).filter(function(t){return!t.children}),p=d.selectAll("g").data(u).enter().append("svg:g").attr("class","cell").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).on("click",function(t){return h.zoom(s==t.parent?o:t.parent)}),p.append("svg:rect").attr("class","map").attr("width",function(t){return t.dx-1}).attr("height",function(t){return t.dy-1}).style("fill",function(t){return i(t.parent.name)}).on("mouseover",function(t){this.style.opacity=.6,m.transition().duration(200).style("opacity",.9),m.html(t.name).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){this.style.opacity=1,m.transition().duration(500).style("opacity",0)}),p.append("svg:text").attr("x",function(t){return t.dx/2}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name.width()>t.dx?t.name.slice(0,5)+"...":t.name}).style("display",function(t){return t.name.width()<t.dx?"block":(t.name.slice(0,5)+"...").width()<t.dx?"block":"none"}),d3.select(window).on("click",function(){h.zoom(o)})})},this.size=function(t){return t.length},this.count=function(t){return 1},this.zoom=function(t){var i=e/t.dx,o=a/t.dy;n.domain([t.x,t.x+t.dx]),r.domain([t.y,t.y+t.dy]);var l=d.selectAll("g.cell").transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+n(t.x)+","+r(t.y)+")"});l.select("rect").attr("width",function(t){return i*t.dx-1}).attr("height",function(t){return o*t.dy-1}),l.select("text").attr("x",function(t){return i*t.dx/2}).attr("y",function(t){return o*t.dy/2}).text(function(t){return t.name.width()>i*t.dx-1?t.name.slice(0,5)+"...":t.name}).style("display",function(t){return t.name.width()<i*t.dx-1?"block":(t.name.slice(0,5)+"...").width()<i*t.dx-1?"block":"none"}),s=t,d3.event.stopPropagation()},String.prototype.width=function(t){var e=t||"11pt helvetica",a=$("<div>"+this+"</div>").css({position:"absolute","float":"left","white-space":"nowrap",visibility:"hidden",font:e}).appendTo($("body")),n=a.width();return a.remove(),n}}function ThreeD(){var t,e=new Rainbow,a,n=[],r={},i=8,o=8,s=.01,l,d,c,u,p,h,m,f,g,v,y,x,b,w,I,A,S,E,D,T=0,B=1,_=2,k=3,N,C,M=this,R=[],L,P,H,W,j=[],O,K="",q=1,z;this.setData=function(a){function r(){d3.select("#visWrapper").append("div").attr("id","axislabels").attr("class","axislabels"),z=new THREE.PerspectiveCamera(se,ce,le,de),document.getElementById("plot").style.overflow="hidden",$("#plot canvas").attr("width",400),$("#plot canvas").attr("height",400),z.aspect=document.getElementById("plot").offsetWidth/document.getElementById("plot").offsetHeight,z.rotation.set(0,0,0),z.updateProjectionMatrix(),z.position.set(0,0,4.8*A+s),g_mainScene=new THREE.Scene,g_mainScene.add(z),O=new THREE.SphereGeometry(s,i,o),W=new THREE.Object3D,g_mainScene.add(W),R(),g_sceneLight=new THREE.DirectionalLight(10066329,2),g_sceneLight.position.set(1,1,1).normalize(),z.add(g_sceneLight),g_sceneControl=new THREE.TrackballControls(z,document.getElementById("plot")),g_sceneControl.rotateSpeed=1,g_sceneControl.zoomSpeed=1.2,g_sceneControl.panSpeed=.8,g_sceneControl.noZoom=!1,g_sceneControl.noPan=!1,g_sceneControl.staticMoving=!0,g_sceneControl.dynamicDampingFactor=.3,g_sceneControl.keys=[65,83,68];var t=new THREE.Color;t.setHex("0xf5f5f5"),g_mainRenderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}),g_mainRenderer.setClearColor(t,1),g_mainRenderer.setSize(document.getElementById("plot").offsetWidth,document.getElementById("plot").offsetHeight),g_mainRenderer.sortObjects=!0,J.append(g_mainRenderer.domElement),K(),V(),G(),M.initLegend(),C()}function T(){requestAnimationFrame(T),N();var t;t=X(new THREE.Vector3(u,f,g),z,$("#plot")),$("#pc1_label").css("left",t.x),$("#pc1_label").css("top",t.y),t=X(new THREE.Vector3(m,p,g),z,$("#plot")),$("#pc2_label").css("left",t.x),$("#pc2_label").css("top",t.y),t=X(new THREE.Vector3(m,f,h),z,$("#plot")),$("#pc3_label").css("left",t.x),$("#pc3_label").css("top",t.y)}function N(){g_sceneControl.update(),g_mainRenderer.render(g_mainScene,z)}function C(){g_sceneControl.reset(),z.aspect=document.getElementById("plot").offsetWidth/document.getElementById("plot").offsetHeight,z.rotation.set(0,0,0),z.updateProjectionMatrix(),z.position.set(0,0,4.8*A+s)}function R(){t.forEach(function(t){var e=new THREE.Mesh(O,new THREE.MeshLambertMaterial);e.material.color=new THREE.Color,e.material.transparent=!0,e.material.depthWrite=!1,e.material.opacity=1,e.position.set(t[B],t[_],t[k]),e.updateMatrix(),e.matrixAutoUpdate=!0,g_mainScene.add(e);var a={mesh:e,obj:t};j.push(a)})}function K(){j.forEach(function(t){t.mesh.material.color.setHex("0x"+e.colorAt(n.indexOf(t.obj.colorKey)))})}function q(){v=d3.max(t,function(t){return t[B]}),y=d3.max(t,function(t){return t[_]}),x=d3.max(t,function(t){return t[k]}),b=d3.min(t,function(t){return t[B]}),w=d3.min(t,function(t){return t[_]}),I=d3.min(t,function(t){return t[k]}),u=v+(v>=0?6*s:-6*s),p=y+(y>=0?6*s:-6*s),h=x+(x>=0?6*s:-6*s),m=b+(b>=0?6*s:-6*s),f=w+(w>=0?6*s:-6*s),g=I+(I>=0?6*s:-6*s),l=u-m,d=p-f,c=h-g,A=d3.max([u,p,h])}function V(){L=F([m,f,g],[u,f,g],"0x000000",3),P=F([m,f,g],[m,p,g],"0x000000",3),H=F([m,f,g],[m,f,h],"0x000000",3),L.material.transparent=!1,P.material.transparent=!1,H.material.transparent=!1,g_mainScene.add(L),g_mainScene.add(P),g_mainScene.add(H)}function F(t,e,a,n){var r,i,o;return r=new THREE.LineBasicMaterial({color:a,linewidth:n}),r.matrixAutoUpdate=!0,r.transparent=!0,r.opacity=1,i=new THREE.Geometry,i.vertices.push(new THREE.Vector3(t[0],t[1],t[2])),i.vertices.push(new THREE.Vector3(e[0],e[1],e[2])),o=new THREE.Line(i,r)}function G(){S="Axis "+B,E="Axis "+_,D="Axis "+k;var t="",e=X(new THREE.Vector3(u,f,g),z,$("#plot"));t+='<label id="pc1_label" class="unselectable labels" style="position:absolute; left:'+parseInt(e.x)+"px; top:"+parseInt(e.y)+'px;">',t+=S,t+="</label>";var a=X(new THREE.Vector3(m,p,g),z,$("#plot"));t+='<label id="pc2_label" class="unselectable labels" style="position:absolute; left:'+parseInt(a.x)+"px; top:"+parseInt(a.y)+'px;">',t+=E,t+="</label>";var n=X(new THREE.Vector3(m,f,h),z,$("#plot"));t+='<label id="pc3_label" class="unselectable labels" style="position:absolute; left:'+parseInt(n.x)+"px; top:"+parseInt(n.y)+'px;">',t+=D,t+="</label>",document.getElementById("axislabels").innerHTML=t}function X(t,e,a){var n=t.clone(),r=new THREE.Matrix4;return r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),n.applyProjection(r),{x:(n.x+1)*a.width()/2+a.offset().left,y:(-n.y+1)*a.height()/2+a.offset().top}}function Y(t){return!isNaN(parseFloat(t))&&isFinite(t)}t=a;var U=d3.keys(t[0]);U.splice(U.indexOf("Individual"),2),t.forEach(function(t){n.push(t.Individual.substring(0,11)),t.Individual=t.Individual.substring(0,11),t.colorKey=t.Individual;var e={};U.forEach(function(e){t[e]=+t[e]})}),n=this.dedupe(n),e.setNumberRange(0,n.length),q();var J=$("#plot"),Z,Q,te,ee,ae,ne,re=0,ie=0,oe=Math.min(document.getElementById("visWrapper").offsetWidth,document.getElementById("visWrapper").offsetHeight),se=25,le=1,de=1e4,ce=document.getElementById("visWrapper").offsetWidth/document.getElementById("visWrapper").offsetHeight;window.WebGLRenderingContext?(r(),T()):window.location="http://get.webgl.org"},this.dedupe=function(t){for(var e={},a=0;a<t.length;a++)e[t[a]]=!0;t=[];for(var n in e)t.push(n);return t},this.changeColors=function(t){this.setColorBy(t)},this.setColorBy=function(a){n=[],t.forEach(function(t){t.colorKey="Environment"==a?-1!=t.SampleID.indexOf("key")||-1!=t.SampleID.indexOf("space")?"Key":"Finger":t.Individual,n.push(t.colorKey)}),n=this.dedupe(n),e.setNumberRange(0,n.length),j.forEach(function(t){t.mesh.material.color.setHex("0x"+e.colorAt(n.indexOf(t.obj.colorKey)))}),this.drawLegend()},this.initLegend=function(){d3.select("#visWrapper").append("div").attr("id","legendDiv"),this.drawLegend()},this.drawLegend=function(){document.getElementById("legendDiv").innerHTML="";var t="<ul>";for(var a in n)t+="<li>"+n[a]+'<div class="colorbox" style="background-color:#'+e.colorAt(a)+'"></div></li>';t+="</ul>",document.getElementById("legendDiv").innerHTML=t}}function DonutCharts(){var t=74,e=10,a,n,r,i,s,l,d,c,u,p,h,m,f=new Rainbow;this.setBiom=function(t){l=t,this.initTaxonomyBarChart()},this.initTaxonomyBarChart=function(){f.setSpectrum("lime","blue","red","yellow"),s=d3.select("#plot").append("div").attr("class","tooltip").style("opacity",0);var e=["Phylum","Class","Order","Family","Genus","Species"];u=d3.select("#plot"),a=d3.svg.arc().outerRadius(t).innerRadius(t-30),n=d3.layout.pie().sort(null).value(function(t){return t.abundance}),this.setData(0),this.setMetadataTypes(),this.setSelect(),this.buildKey(m),i=u.selectAll(".pie").data(d).enter().append("svg").attr("class","pie").attr("width",2*t).attr("height",2*t).append("g").attr("transform","translate("+t+","+t+")"),r=i.selectAll(".arc").data(function(t){return n(t.abundances)}).enter().append("path").attr("class","arc").attr("d",a).style("fill",function(t){return"#"+f.colorAt(d3.keys(d[d3.keys(d)[0]].tax).indexOf(t.data.name))}),i.append("text").attr("dy",".35em").style("text-anchor","middle").text(function(t){return t.name}),this.getTotalAbundances(d),this.drawTaxonomyBarVis(d),document.getElementById("sort_by_select").disabled=!0},this.changeLevel=function(t){document.querySelectorAll(".selected_classification")[0].className="unselected_classification",document.getElementById("classification"+t).className="selected_classification",this.setData(t),this.buildKey(m),this.getTotalAbundances(d),this.drawTaxonomyBarVis(d)},this.setSelect=function(){var t=document.getElementById("sort_by_select"),e=document.getElementById("group_by_select"),a=document.createElement("option");a.text="SampleID",t.add(a),a=document.createElement("option"),a.text="SampleID",e.add(a);for(var n in l.columns[0].metadata)a=document.createElement("option"),a.text=n,t.add(a),a=document.createElement("option"),a.text=n,e.add(a)},this.setMetadataTypes=function(){c={};for(var t=0;t<d3.keys(d[d3.keys(d)[0]].metadata).length;t++)c[d3.keys(d[d3.keys(d)[0]].metadata)[t]]=null;for(var e in c){var a,n=Number(d[d3.keys(d)[0]].metadata[e]);a=isNaN(n)?"string":"number";for(var r in d){var i=d[r].metadata[e];if("NA"!=i){var o=Number(i),s;if(s=isNaN(o)?"string":"number",s!==a){a="string";break}}}c[e]=a}},this.sortChanged=function(){},this.getTotalAbundances=function(t){var e={};for(var a in t)for(var n=t[a].abundances,r=0;r<n.length;r++)n[r].name in e||(e[n[r].name]=0),e[n[r].name]+=Math.abs(n[r].y0-n[r].y1)},this.groupChanged=function(){for(var t=[],e={},a={},n=document.getElementById("group_by_select")[document.getElementById("group_by_select").selectedIndex].text,r=d3.keys(d),i=0;i<r.length;i++){var o=r[i],s=d[o].metadata[n];"SampleID"==n&&(s=d[o].SampleID),s in a||(a[s]={}),s in e||(e[s]=0),e[s]+=1;for(var l=d3.keys(d[o].tax),u=0;u<l.length;u++){var p=l[u];p in a[s]||(a[s][p]=0),a[s][p]+=d[o].tax[p]}}for(var h=d3.keys(a),m,i=0;i<h.length;i++)m={SampleID:h[i]},m.tax=a[h[i]],m.count=e[h[i]],t.push(m);var f=d3.keys(d[d3.keys(d)[0]].tax);t.forEach(function(t){t.name=t.SampleID,t.abundances=f.map(function(e){return{name:e,abundance:+t.tax[e]}}),t.metadata=t.metadata});var g=c[n];t.sort(function(t,e){var a;return"NA"==t.SampleID&&"NA"==e.SampleID?0:"NA"==t.SampleID&&"NA"!==e.SampleID?-1:"NA"!==t.SampleID&&"NA"==e.SampleID?1:"string"===g?t.SampleID.localeCompare(e.SampleID):"number"===g?Number(t.SampleID)-Number(e.SampleID):0}),this.getTotalAbundances(t),this.drawTaxonomyBarVis(t,!0)},this.setData=function(t){d=[];var e=[],a={};if(m=[],"dense"==l.matrix_type)for(var n=0;n<l.columns.length;n++){e[n]=l.columns[n].id,a={SampleID:e[n]},a.metadata=l.columns[n].metadata,a.tax={};for(var r=0;r<l.rows.length;r++){var i=l.rows[r].metadata.taxonomy[t];m.push(i),i in a.tax||(a.tax[i]=0),a.tax[i]+=l.data[r][n]}d.push(a)}else{var s={};m=[];for(var r=0;r<l.data.length;r++){var c=l.data[r][0],u=l.data[r][1],p=l.data[r][2],i=l.rows[c].metadata.taxonomy[t];if(void 0!=i){m.push(i);var h=l.columns[u].id;h in s||(s[h]={},s[h].metadata=l.columns[u].metadata),i in s[h]||(s[h][i]=0),s[h][i]+=p}}m=this.dedupe(m);for(o in s){a={SampleID:o},a.metadata=s[o].metadata,a.tax={};for(var n=0;n<m.length;n++)a.tax[m[n]]=m[n]in s[o]?s[o][m[n]]:0;d.push(a)}}var g=d3.keys(d[d3.keys(d)[0]].tax);d.forEach(function(t){t.name=t.SampleID,t.abundances=g.map(function(e){return{name:e,abundance:+t.tax[e]}}),t.metadata=t.metadata}),m.sort(),f.setNumberRange(0,g.length)},this.buildKey=function(t){var e="<ul id='key'>",a="";for(var n in t)e+="<li><div class='colorbox' style='background-color:",e+="#"+f.colorAt(n),e+="'></div>"+t[n]+"</li>";e+="</ul>",document.getElementById("color_list").innerHTML=e},this.dedupe=function(t){for(var e={},a=0;a<t.length;a++)e[t[a]]=!0;t=[];for(var n in e)t.push(n);return t},this.drawTaxonomyBarVis=function(e,o){u.selectAll(".pie").remove(),i.selectAll("text").remove(),i=u.selectAll(".pie").data(e).enter().append("svg").attr("class","pie").attr("width",2*t).attr("height",2*t).append("g").attr("transform","translate("+t+","+t+")"),r=i.selectAll(".arc").data(function(t){return n(t.abundances)}).enter().append("path").attr("class","arc").attr("d",a).style("fill",function(t){return"#"+f.colorAt(m.indexOf(t.data.name))}).on("mouseover",function(t){this.style.opacity=.6,s.transition().duration(200).style("opacity",.9),s.html(t.data.name+": "+t.data.abundance).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){this.style.opacity=1,s.transition().duration(500).style("opacity",0)}),i.append("text").attr("dy",".35em").style("text-anchor","middle").text(function(t){return t.name})}}function StackedBar(){var t,e,a,n,r,i,s,l,d,c,s,u,p,h,m,f,g,v,y,x,b,w,I=new Rainbow,A,S="",E="";this.setBiom=function(t){p=t,this.initTaxonomyBarChart()},this.initTaxonomyBarChart=function(){a=document.getElementById("plot").offsetWidth,t={top:30,right:20,bottom:180,left:60},e=.97*a,n=600-t.top-t.bottom,r=d3.scale.ordinal().rangeBands([0,e],.1),i=d3.scale.linear().rangeRound([n,0]),I.setSpectrum("lime","blue","red","yellow"),d=d3.svg.axis().scale(r).orient("bottom"),c=d3.svg.axis().scale(i).orient("left").tickFormat(d3.format(".2s")),u=d3.select("#plot").append("div").attr("class","tooltip").style("opacity",0);var o=["Phylum","Class","Order","Family","Genus","Species"];g=d3.select("#yaxisholder"),x=g.append("svg").attr("width",t.left).attr("height",n+t.top+10).attr("id","yaxis").append("g").attr("transform","translate("+t.left+","+t.top+")"),f=d3.select("#plot"),v=f.append("svg").attr("width",e+t.right).attr("height",n+t.top+t.bottom).attr("id","chart").append("g").attr("transform","translate(10,"+t.top+")"),this.setData(0),this.setMetadataTypes(),this.setSelect(),this.buildKey(b),r.domain(h.map(function(t){return t.SampleID}));var l=[{SampleID:"Sample1"}];y=v.selectAll(".SampleID").data(l).enter().append("g").attr("class","SampleID"),x.append("g").attr("class","y axis").call(c),x.append("text").attr("class","axisLabel").attr("text-anchor","middle").attr("y",-55).attr("x",-n/2).attr("dy",".75em").attr("transform","rotate(-90)").text("Abundance");var p=[{group:"SampleID"}];s=v.selectAll(".sortHeaders").data(p).enter().append("g").attr("class","groups"),this.sortChanged()},this.changeLevel=function(t){document.querySelectorAll(".selected_classification")[0].className="unselected_classification",document.getElementById("classification"+t).className="selected_classification",A=t,this.setData(t),this.buildKey(b),this.sortChanged()},this.setSelect=function(){var t=document.getElementById("sort_by_select"),e=document.getElementById("group_by_select"),a=document.createElement("option");a.text="SampleID",t.add(a),a=document.createElement("option"),a.text="SampleID",e.add(a);var n=d3.keys(p.columns[0].metadata);n.sort();for(var r in n)a=document.createElement("option"),a.text=n[r],t.add(a),a=document.createElement("option"),a.text=n[r],e.add(a)},this.setMetadataTypes=function(){m={};for(var t=0;t<d3.keys(h[d3.keys(h)[0]].metadata).length;t++)m[d3.keys(h[d3.keys(h)[0]].metadata)[t]]=null;for(var e in m){var a,n=Number(h[d3.keys(h)[0]].metadata[e]);a=isNaN(n)?"string":"number";for(var r in h){var i=h[r].metadata[e];if("NA"!=i){var o=Number(i),s;if(s=isNaN(o)?"string":"number",s!==a){a="string";break}}}m[e]=a}},this.sortChanged=function(){var t=document.getElementById("sort_by_select")[document.getElementById("sort_by_select").selectedIndex].text,e=m[t];E=t,h.sort(function(a,n){var r;return r="SampleID"==t?a.SampleID.localeCompare(n.SampleID):"NA"==a.metadata[t]&&"NA"==n.metadata[t]?0:"NA"==a.metadata[t]&&"NA"!==n.metadata[t]?-1:"NA"!==a.metadata[t]&&"NA"==n.metadata[t]?1:"number"===e?a.metadata[t]-n.metadata[t]:"string"===e?a.metadata[t].localeCompare(n.metadata[t]):0,0==r?a.SampleID.localeCompare(n.SampleID):r});var a={};"SampleID"!==t&&h.forEach(function(e){var n=e.metadata[t];n in a?a[n]++:a[n]=1}),document.getElementById("group_by_select").selectedIndex=0,this.getTotalAbundances(h),this.drawTaxonomyBarVis(h),a.length!==h.length&&"SampleID"!==t&&this.drawSortHeaders(a)},this.getTotalAbundances=function(t){var e={};for(var a in t)for(var n=t[a].abundances,r=0;r<n.length;r++)n[r].name in e||(e[n[r].name]=0),e[n[r].name]+=Math.abs(n[r].y0-n[r].y1)},this.groupChanged=function(){var t=[],e={},a={},n=document.getElementById("group_by_select")[document.getElementById("group_by_select").selectedIndex].text;E=n;for(var r=d3.keys(h),i=0;i<r.length;i++){var o=r[i],l=h[o].metadata[n];"SampleID"==n&&(l=h[o].SampleID),l in a||(a[l]={}),l in e||(e[l]=0),e[l]+=1;for(var d=d3.keys(h[o].tax),c=0;c<d.length;c++){var u=d[c];u in a[l]||(a[l][u]=0),a[l][u]+=h[o].tax[u]}}for(var p=d3.keys(a),f,i=0;i<p.length;i++)f={SampleID:p[i]},f.tax=a[p[i]],f.count=e[p[i]],t.push(f);var g=d3.keys(h[d3.keys(h)[0]].tax);t.forEach(function(t){var e=0;t.abundances=g.map(function(a){return{name:a,y0:e,y1:e+=+t.tax[a]}}),t.total=t.abundances[t.abundances.length-1].y1,t.metadata=t.metadata}),I.setNumberRange(0,g.length);var v=m[n];t.sort(function(t,e){var a;return"NA"==t.SampleID&&"NA"==e.SampleID?0:"NA"==t.SampleID&&"NA"!==e.SampleID?-1:"NA"!==t.SampleID&&"NA"==e.SampleID?1:"string"===v?t.SampleID.localeCompare(e.SampleID):"number"===v?Number(t.SampleID)-Number(e.SampleID):0}),this.getTotalAbundances(t),this.drawTaxonomyBarVis(t,!0),s.selectAll("g").remove()},this.setData=function(t){h=[];var e=[],a={};if(b=[],"dense"==p.matrix_type)for(var n=0;n<p.columns.length;n++){e[n]=p.columns[n].id,a={SampleID:e[n]},a.metadata=p.columns[n].metadata,a.tax={};for(var r=0;r<p.rows.length;r++){var i=p.rows[r].metadata.taxonomy[t];b.push(i),i in a.tax||(a.tax[i]=0),a.tax[i]+=p.data[r][n]}h.push(a)}else{var s={};b=[];for(var r=0;r<p.data.length;r++){var l=p.data[r][0],d=p.data[r][1],c=p.data[r][2],i=p.rows[l].metadata.taxonomy[t];if(void 0!=i){b.push(i);var u=p.columns[d].id;u in s||(s[u]={},s[u].metadata=p.columns[d].metadata),i in s[u]||(s[u][i]=0),s[u][i]+=c}}b=this.dedupe(b);for(o in s){a={SampleID:o},a.metadata=s[o].metadata,a.tax={};for(var n=0;n<b.length;n++)a.tax[b[n]]=b[n]in s[o]?s[o][b[n]]:0;h.push(a)}}var m=d3.keys(h[d3.keys(h)[0]].tax);h.forEach(function(t){var e=0;t.abundances=m.map(function(a){return{name:a,y0:e,y1:e+=+t.tax[a]}}),t.total=t.abundances[t.abundances.length-1].y1,t.metadata=t.metadata}),h.sort(function(t,e){return e.total-t.total}),b.sort(),I.setNumberRange(0,m.length)},this.buildKey=function(t){var e="<ul id='key'>",a="";for(var n in t)e+="<li><div class='colorbox' style='background-color:",e+="#"+I.colorAt(n),e+="'></div>"+t[n]+"</li>";e+="</ul>",document.getElementById("color_list").innerHTML=e},this.dedupe=function(t){for(var e={},a=0;a<t.length;a++)e[t[a]]=!0;t=[];for(var n in e)t.push(n);return t},this.drawSortHeaders=function(t){var e=[],a=0,i=r.rangeBand()+.1*r.rangeBand();for(var o in t)e.push({group:o,count:t[o],offset:a*i+.1*r.rangeBand(),textLocation:a*i+.1*r.rangeBand()+t[o]*i/2,width:t[o]*i}),a+=t[o];var l=s.selectAll("g").data(e,function(t){return t.group});l.enter().append("g").attr("width",function(t){return t.width}).attr("height",10).attr("x",function(t){return t.offset}).on("mouseover",function(t){}).on("mouseout",function(t){}).append("text").attr("class","sortLabel").attr("x",function(t){return t.textLocation}).attr("y",-13).attr("text-anchor","middle").text(function(t){return t.group}),l.append("rect").attr("width",1).attr("height",5).attr("y",-10).attr("x",function(t){return t.textLocation}),l.append("rect").attr("fill-opacity","0").attr("stroke","#000").attr("id",function(t){return t.group+"Rect"}).attr("width",function(t){return t.width}).attr("height",n+5).attr("y",-5).attr("x",function(t){return t.offset}).attr("rx",3).attr("ry",3),l.exit().remove()},this.drawTaxonomyBarVis=function(o,s){e=Math.max(.97*a,o.length+10),f.selectAll("svg").attr("width",e+t.right),r=d3.scale.ordinal().rangeRoundBands([0,e],.1),o.forEach(function(t){t.uniquename=t.SampleID+A+S+E}),r.domain(o.map(function(t){return t.SampleID})),i.domain([0,d3.max(o,function(t){return t.total})]),v.selectAll(".xAxisLabel").remove(),x.selectAll(".y.axis").remove(),y.selectAll("text").remove(),c=d3.svg.axis().scale(i).orient("left").tickFormat(d3.format(".2s")),x.append("g").attr("class","y axis").call(c);var l=y.selectAll("g").data(o,function(t){return t.uniquename});l.enter().append("g").attr("transform",function(t){return"translate("+r(t.SampleID)+",0)"}),o.length<100&&(s=!0),s?l.append("text").attr("y",r.rangeBand()/2).attr("x",-n-15).attr("text-anchor","end").attr("transform",function(t){return"rotate(-90)"}).text(function(t){return t.SampleID}):v.append("text").attr("class","xAxisLabel").attr("text-anchor","middle").attr("x",e/2).attr("y",n+50).text("Sample");var d=l.selectAll("rect").data(function(t){return t.abundances});d.enter().append("rect").attr("width",r.rangeBand()).attr("y",function(t){return i(t.y1)}).attr("height",function(t){return i(t.y0)-i(t.y1)}).style("fill",function(t){return"#"+I.colorAt(b.indexOf(t.name))}).on("mouseover",function(t){this.style.opacity=.6,u.transition().duration(200).style("opacity",.9),u.html(t.name+": "+Math.abs(t.y0-t.y1)).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){this.style.opacity=1,u.transition().duration(500).style("opacity",0)}),d.exit().remove(),l.exit().remove()}}function sunburst(){s=new Sunburst("data/keyboard_mini.json"),d3.select("#visWrapper").selectAll("div").remove(),d3.select("#visWrapper").append("div").attr("id","sequence"),d3.select("#visWrapper").append("div").attr("id","plot"),d3.select("#visWrapper").append("div").attr("id","text_width"),s.initSunburst()}function rectangularTree(){function t(e,n){if(a.push(e),e.branchset)for(var r=0;r<e.branchset.length;r++)t(e.branchset[r])}d3.select("#visWrapper").selectAll("div").remove(),d3.select("#visWrapper").append("div").attr("id","plot");var e=Newick.parse("((Taxon6:0.020,(Taxon7:0.076,Taxon8:0.093):0.011):0.015,(Taxon1:0.011,(Taxon2:0.032,(Taxon3:0.030,(Taxon4:0.014,Taxon5:0.050):.001):0.006):0.017):0.016);"),a=[];t(e),d3.phylogram.build("#plot",e,{width:400,skipLabels:!1})}function radialTree(){function t(e,n){if(a.push(e),e.branchset)for(var r=0;r<e.branchset.length;r++)t(e.branchset[r])}d3.select("#visWrapper").selectAll("div").remove(),d3.select("#visWrapper").append("div").attr("id","plot");var e=Newick.parse("((Taxon6:0.020,(Taxon7:0.076,Taxon8:0.093):0.011):0.015,(Taxon1:0.011,(Taxon2:0.032,(Taxon3:0.030,(Taxon4:0.014,Taxon5:0.050):.001):0.006):0.017):0.016);"),a=[];t(e),d3.phylogram.buildRadial("#plot",e,{width:600,skipLabels:!1})}function comparativeSunburst(){s=new ComparativeSunburst,d3.select("#visWrapper").selectAll("div").remove(),d3.select("#visWrapper").append("div").attr("id","plot1").attr("class","plot"),d3.select("#visWrapper").append("div").attr("id","plot2").attr("class","plot"),queue().defer(d3.json,"data/comp_small_1.json").defer(d3.json,"data/comp_small_2.json").await(function(t,e,a){initComp(e,a)})}function treemap(){s=new Treemap("data/keyboard_mini.json"),d3.select("#visWrapper").selectAll("div").remove(),d3.select("#visWrapper").append("div").attr("id","plot"),d3.select("#visWrapper").append("div").attr("id","text_width"),s.initTreemap()}function partition(){s=new Partition("sunburst/data/test.json"),d3.select("#visWrapper").selectAll("div").remove(),d3.select("#visWrapper").append("div").attr("id","plot"),d3.select("#visWrapper").append("div").attr("id","text_width"),s.initPartition()}function initComp(t,e){s.setVals(t,e)}function stackedBar(){s=new StackedBar,initAbundance()}function normStackedBar(){s=new NormalizedStackedBar,initAbundance()}function groupedBar(){s=new GroupedBar,initAbundance()}function donuts(){s=new DonutCharts,initAbundance()}function initAbundance(){d3.select("#visWrapper").selectAll("div").remove(),d3.select("#visWrapper").html(abundancehtml),queue().defer(d3.json,"data/current").await(loadBiom)}function loadBiom(t,e){s.setBiom(e)}function parallel(){s=new ParallelCoordinates,initMultiDim()}function splom(){s=new Splom,initMultiDim()}function scatter(){s=new Scatter,initMultiDim()}function threeD(){s=new ThreeD,initMultiDim()}function initMultiDim(){d3.select("#visWrapper").selectAll("div").remove(),d3.select("#visWrapper").append("div").attr("id","plot").attr("class","plot"),d3.select("#visWrapper").append("div").attr("id","toggleHolder"),document.getElementById("toggleHolder").innerHTML=" <div id='colorBy'>Color by:<br><input type='radio' id='Individual' name='colorBy' checked='checked'><label for='Individual'>Individual</label><input type='radio' id='Environment' name='colorBy'><label for='Environment'>Environment</label></div>",$("#colorBy").buttonset().change(function(t){s.changeColors(t.target.id)}),queue().defer(d3.csv,"data/keyboard_realIDs.csv").await(loadMultiDim)}function loadMultiDim(t,e){s.setData(e)}var width=750,height=600,radius=Math.min(width,height)/2,b={w:75,h:30,s:3,t:10},colors={home:"#5687d1",product:"#7b615c",search:"#de783b",account:"#6ab975",other:"#a173d1",end:"#bbbbbb"},totalSize=0,vis=d3.select("#chart").append("svg:svg").attr("width",width).attr("height",height).append("svg:g").attr("id","container").attr("transform","translate("+width/2+","+height/2+")"),partition=d3.layout.partition().size([2*Math.PI,radius*radius]).value(function(t){return t.size}),arc=d3.svg.arc().startAngle(function(t){return t.x}).endAngle(function(t){return t.x+t.dx}).innerRadius(function(t){return Math.sqrt(t.y)}).outerRadius(function(t){return Math.sqrt(t.y+t.dy)});createVisualization(d3.json("data/test2.json"));var x,y,width=600,height=width,padding=5,radius=(Math.min(width,height)-2*padding)/2,duration=1e3,arc,path1,path2,root1,rainbow1=new Rainbow,rainbow2=new Rainbow,div,b={w:75,h:30,s:3,t:10},s,abundancehtml='<div id="breadcrumbs"><ul><li id="classification0" class="selected_classification"><a href="javascript:s.changeLevel(\'0\')">Kingdom</a></li>        <li id="classification1" class="unselected_classification"><a href="javascript:s.changeLevel(\'1\')">Phylum</a></li>        <li id="classification2" class="unselected_classification"><a href="javascript:s.changeLevel(\'2\')">Class</a></li>        <li id="classification3" class="unselected_classification"><a href="javascript:s.changeLevel(\'3\')">Order</a></li>        <li id="classification4" class="unselected_classification"><a href="javascript:s.changeLevel(\'4\')">Family</a></li>        <li id="classification5" class="unselected_classification"><a href="javascript:s.changeLevel(\'5\')">Genus</a></li>        <li id="classification6" class="unselected_classification"><a href="javascript:s.changeLevel(\'6\')">Species</a></li>        </ul>    </div>    <div id="yaxisholder"></div> <div id="plot"></div>   <div id="options">        <div id="sort_by">            Sort By: <select id="sort_by_select" onchange="javascript:s.sortChanged()">            </select>        </div>        <br />        <div id="group_by">            Group By: <select id="group_by_select" onchange="javascript:s.groupChanged()">            </select>        </div>        <div id="color_list">        </div></div>',multidimhtml="";